## IKE VPN

This is all based on HTB's Conceal box, so I'm sure other scenarios will be different, but it gives you an idea.

1. Find a valid transformation

   ```bash
   sudo ike-scan -M 10.10.10.116
   ```

   Look at the last line for the returned handshake and notify.

   1. *0 returned handshake; 0 returned notify:* not an IPsec gateway.
   2. *1 returned handshake; 0 returned notify*: target is configured for IPsec and is willing to perform IKE negotiation, and either one or more of the transforms you proposed are acceptable (a valid transform will be shown in the output)
   3. *0 returned handshake; 1 returned notify:* VPN gateways respond with a notify message when **none of the transforms are acceptable** (though some gateways do not, in which case further analysis and a revised proposal should be tried).  If this occurs, follow this page for more details on discovering the transform: https://book.hacktricks.xyz/pentesting/ipsec-ike-vpn-pentesting

2. The page above details how to crack the PSK, but hopefully you can find it an easier way.

3. Add the PSK to your ipsec secrets file:

   ```bash
   sudo vi /etc/ipsec.secrets
   # Added this:
   10.10.10.116 : PSK "Dudecake1!"
   ```

4. Create a connection profile for strongswan using the info from ike-scan:

   ```bash
   # Lines From IKE Scan
   SA=(Enc=3DES Hash=SHA1 Group=2:modp1024 Auth=PSK LifeType=Seconds LifeDuration(4)=0x00007080)
   VID=e3a5966a76379fe707228231e5ce8652 (IKE CGA version 1) 
   
   # Config for strongswan
   conn Conceal
       type=transport	# Used to just encrypt traffic rather than make a tunnel.  Dunno how you are supposed to know that
       keyexchange=ikev1	# Given by the VID line from iker
       right=10.10.10.116	# IP of VPN server
       authby=psk	# SA line, Auth=PSK tells us this
       rightprotoport=tcp	# This is a guess, would've used UDP if this failed
       leftprotoport=tcp	# This is a guess, would've used UDP if this failed
       esp=3des-sha1	# SA Line, Enc=3DES & Hash=SHA1 give us this
       ike=3des-sha1-modp1024	# SA Line, Enc=3DES, Hash=SHA1 & Group=2:modp1024 give us this
       auto=start	# Starts the connection with ipsec startup
   ```

   Note:  Here's strongswan's complete and overwhelming documentation on this:  https://wiki.strongswan.org/projects/strongswan/wiki/ConnSection

5. Restart ipsec to start this connection

   ```bash
   sudo ipsec stop
   sudo ipsec start --nofork	# this is for debugging, I guess so all the output shows up in the console window
   ```

   

