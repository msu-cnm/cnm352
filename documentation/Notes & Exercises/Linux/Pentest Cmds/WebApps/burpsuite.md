## Burp Suite - Web Pentesting Suite

A GUI-based collection of tools geared towards web application security testing,
arguably best-known as a powerful proxy tool. While the free Community Edition mainly contains tools used in manual testing, the commercial versions include additional features, including a formidable web application vulnerability scanner.   

### Launching

Run `burpsuite`, then choose 'Temporary Project', then 'Burp defaults', then 'Start Burp'.

### Proxy

This tab configures the proxy server that allows you to intercept any request sent from the browser before it's passed to the server, including editing values, parameters, headers, etc.

The proxy server runs on 127.0.0.1:8080.  Using this proxy server in your browser will cause all traffic to flow through Burp Suite.

With Intercept turned on in the 'Intercept' sub-tab, you must manually forward all traffic for the communication to proceed.  If there is no need to analyze some particular traffic, click the 'Intercept is on' toggle button to turn off intercept and allow traffic to flow automatically.

The 'User Options' tab, 'Misc' sub-tab, 'Proxy Interception' section allows you to set the behavior of Intercept, which is always enabled on startup by default.

[FoxyProxy Basic](https://addons.mozilla.org/en-US/firefox/addon/foxyproxy-basic/) is a useful add-on that gives you a Proxy toggle button in Firefox to quickly turn on and off the proxy configuration in the browser.  This is useful for quickly sending input to Burp Suite, and then quickly turning it off to bypass Burp Suite.

#### Certificate Errors

When proxying to HTTPS sites, Firefox will generate an error since Burp Suite is using a self-signed cert that Firefox doesn't trust.  To fix this

1. Generate a new cert in Burp Suite:
   1. 'Proxy' Tab -> 'Options' sub-tab -> 'Regenerate CA Certificate'
2. Import the certificate into Firefox:
   1. Browse to http://burp
   2. Click the 'CA Certificate' link at the top right and Save the file
   3. Go to your Downloads Folder in Kali, then drag & drop the cacert.der file into the Firefox window.
   4. In the 'Downloading Certificate' pop-up, check 'Trust this CA to identify websites.' and click OK.
3. Verify you do not receive a certificate error by visiting an HTTPS site such as https://www.google.com

### Repeater

Allows you to modify requests, resend them, and view the response.  This is very useful for the trial and error work needed for web app exploits and saves time to not have to wait for the browser to render every response.  

You can click almost any element in Burp Suite (such as a line in 'Proxy' -> 'HTTP History') and click 'Send to Repeater' to load the data from the previously selected element into the Repeater tab.  

You will notice the Repeater tab color will change to orange, indicating activity in that tab.  Going to that tab will show a numbered sub-tab with the data that we sent loaded.

After modifying the options, click 'Send' to send that HTTP request to the server.  The response of the server in Raw format is shown to the right, as well as the headers and hex.

#### Auto-Scroll

In the Response Window, at the bottom to the left of the search bar is a gear with options.  You can check 'auto-scroll' to have the Response window auto scroll to the first match in the response, which can eliminate some needless scrolling as you run through matches.

### Intruder

Allows for the automation of brute-force type attacks.

#### Positions

The positions tab allows for fields in the HTTP request to be marked for as payload positions for payloads to be injected into them.

##### Attack Types

Pitchfork - Allows a unique payload list to be set for each position.

#### Payloads

This tab defines the data that is inserted into the positions that were created.  Each position is assigned a Payload Set number, number in the order they appear in the HTTP request.  Specify which position you want to configure the payload for by changing the 'Payload Set' at the top. 

#### Options

##### Grep Extract

This option allows you to extract information from a request to be used in the next request.  This is useful for handling session ID's or tokens that change each time a request is generated.  Burp Suite will use the FIRST instance it finds of any match.

Click 'Add' to To define a match, which will show an HTTP response from the server.  Highlight the data you want to grab and it will automatically fill in the characters before the desired data as the 'start after expression' and the characters after it in the 'end at delimiter'.  Whatever is highlighted in red is what will be grabbed.

These extracts can be used in the Payload tab by selecting Payload type 'Recursive Grep'

#### Avoiding Anti-CSRF

When attacking a server that uses anti-CSRF (tokens that appear in the response that must be used in the next request), use Grep Extract to get the tokens from the previous response, but you need to generate one request through BurpSuite, get the tokens from it and set those as the initial values.  <u>**You also need to uncheck "Make unmodified baseline request" in options tab**</u>, otherwise it will make one request without the options and mess up your sequence.

