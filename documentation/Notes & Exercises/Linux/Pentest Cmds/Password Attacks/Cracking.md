## Password Cracking

### Windows Hashes

The hashes in the hashfile should be in the format of `username:NTLM_hash`.  You do not need to prepend the hash with the Generic Windows LM hash, JTR is fairly forgiving.  NT format example:   

```bash
# This was obtained from gsecdump -s
alice(current):1004:aad3b435b51404eeaad3b435b51404ee:b74242f37e47371aff835a6ebcac4ffe:::
# You can also just do this:
alice:b74242f37e47371aff835a6ebcac4ffe
```

#### Simple Brute Force

This will probably take a long time, but takes more guesses.

Cracked hashes are stored in `~/.john/john.pot`

```bash
sudo john hash.txt --format=NT

# Options
hash.txt	# File containing the hashes
--format=NT		# Specifies Windows Hash values
```

#### WordList

```bash
john --wordlist=/usr/share/wordlists/rockyou.txt hash.txt --format=NT

# Options
--wordlist=/usr/share/wordlists/rockyou.txt	# Specifies wordlist to use for password guesses
```

#### Word Mangling

```bash
john --rules --wordlist=/usr/share/wordlists/rockyou.txt hash.txt --format=NT

# Options
--rules		# Tells JTR to use the word mangling rules to create more guesses
```

#### Show Cracked Passwords

```bash
john hash.txt --show --format=NT

# Options
--show		# Tells John to show the status of the cracked passwords for the given hash file, including how many remain to be cracked.
```

### Linux Passwords

- First use `unshadow` to combine the /etc/passwd and /etc/shadow files.

  ```bash
  # Extract the info from /etc/passwd and /etc/shadow to two separate files.  You can filter for specific users.
  grep victim /etc/passwd > passwd-file.txt
  sudo grep victim /etc/shadow > shadow-file.txt
  # Generate format for use with JTR
  unshadow passwd-file.txt shadow-file.txt > unshadowed.txt
  ```

- Run JTR

  ```bash
  john --rules --wordlist=/usr/share/wordlists/rockyou.txt unshadowed.txt
  ```

### Hash Formats

You can view the formats JTR supports (which may vary by Linux Distro) with `john --list=formats`

Newer versions of Kali Linux use yescrypt, which is `format=crypt` and this doesn't autodetect, so you do need to specify it.

### Compressed Files

To crack the passwords on compressed files:

```bash
# Depending on the archive type
zip2john test.zip > zip.hashes
rar2john test.rar > rar.hashes

# Now crack the hash in the zip file like normal
john --wordlist=/usr/share/wordlists/rockyou.txt zip.hashes
```

### JTR Options

New versions of JTR are multi-threaded by default, but it can also be enabled on older versions with the `--fork=N` option, where N is the number of CPU cores.

JTR cracking can be distributed across multiple computers with the `--node=x-y/N` option.  N is the total number of cores among the nodes, x-y is that particular node's portion of load.  So if there are two machines with 8 cores each, the first machine would use option `fork=8 node=1-8/16` and the second machine would use `fork=8 node=9-16/16`

### Hashcat

Hashcat is an alternative to JTR that mirrors many of its features but will also leverage the GPU in addition to the CPU to attain even greater cracking speeds.  The GPU boost will not work on a VM which does not have access to the GPU of the host machine, however.

Install with:

```bash
sudo apt install hashcat
```

To crack a hash file:

```bash
hashcat –m 0 HASHFILE /usr/share/wordlists/rockyou.txt

# Options
-m 0	# Sets the mode to use, 0 = md5
```

Cracked hashes are stored in a `hashcat.pot` stored in the same directory hashcat was run from.

Run a benchmark with

```bash
hashcat -b
```

#### Hob0Rules & Wordlists

Password cracking rules for Hashcat based on statistics and industry patterns.  https://github.com/praetorian-code/Hob0Rules

You can add these rules to the hashcat rules in `/usr/share/hashcat/rules`

Suggested wordlists are the `english.txt`, `rockyou.txt`, and `shortKrak.txt` lists

- \##hob064 This ruleset contains 64 of the most frequent password patterns used to  crack passwords. Need a hash cracked quickly to move on to more testing? Use this list.

  ```bash
  hashcat -a 0 -m 1000 <NTLMHASHES> wordlists/rockyou.txt -r hob064.rule -o cracked.txt
  ```

- \##d3adhob0 This ruleset is much more extensive and utilizes many common password  structure ideas seen across every industry. Looking to spend several  hours to crack many more hashes? Use this list.

  ```bash
  hashcat -a 0 -m 1000 <NTLMHASHES> wordlists/english.txt -r d3adhob0.rule -o cracked.txt
  ```


### Wordlists


These are some links to wordlists that can be tried.

https://github.com/praetorian-code/Hob0Rules/tree/master/wordlists

This forum post has several, some are included below:  https://hashcat.net/forum/thread-1236.html

- https://wiki.skullsecurity.org/Passwords
- https://packetstormsecurity.com/Crackers/wordlists/

- http://www.md5this.com/tools/wordlists.html

This is also a good site to use with a high success rate:  https://crackstation.net/

### Creating a Test List

If you are unsure if your cracker is working, use this to create a test list of easily crackable passwords to run through it.

```bash
echo -n "Password1" | md5sum | tr -d " -" >> hashes
echo -n "HELLO" | md5sum | tr -d " -" >> hashes
echo -n "MYSECRET" | md5sum | tr -d " -" >> hashes
echo -n "Test1234" | md5sum | tr -d " -" >> hashes
echo -n "P455w0rd" | md5sum | tr -d " -" >> hashes
echo -n "GuessMe3" | md5sum | tr -d " -" >> hashes
echo -n "S3CuReP455Word" | md5sum | tr -d " -" >> hashes
echo -n "HighlyUnlik3lyToB3Cr4ck3d…" | md5sum | tr -d " -" >> hashes
```

