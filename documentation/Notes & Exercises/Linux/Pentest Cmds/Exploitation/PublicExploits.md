## Online Sources of Exploits

After the information gathering and enumeration stages, you should cross-check discovered software for known vulnerabilities.

### Top 3 Trusted Sites:

NOTE:  The code on these sites is vetted, BUT you should always understand what the code does before using it.

- Exploit Database
  - https://www.exploit-db.com
  - Maintained by Offensive Security
  - Free archive of public exploits
  - Can filter by type, platform, author, port or tags
  - Occasionally provides the installer for the vulnerable version of software for resource purpose, shown as a download icon in the 'A' column.  (Filter for these with the 'Has App' checkbox)
  - Indicates which exploits are known to be valid, indicated by a checkmark in the 'V' column.  (Filter for these with the 'Verified' checkbox)
  - You can also filter by clicking on text in the columns to apply that as a filter
  - Get announcements through http://twitter.com/exploitdb and https://www.exploit-db.com/rss.xml
- SecurityFocus Exploit Archives
  -  https://www.securityfocus.com
  -  Vulnerability database, that does not contain proof of concept code for many entries
  -  Each entry does contain external references with info regarding the vulnerability and PoC code.
  -  Updates https://twitter.com/securityfocus and https://www.securityfocus.com/rss/index.shtml
- Packet Storm
  -  https://packetstormsecurity.com
  -  Posts info about exploits and vulnerabilities
  -  Also hosts security tools tailored to specific vulnerabilities or scenarios
  -  Updates https://twitter.com/packet_storm and https://packetstormsecurity.com/feeds

### Google Search Operators

- Search for the software name and version along with 'exploit'
- Some good operators to use:
  - Restrict to a domain `site:`
  - Search URL `inurl:`
  - Search text of page `intext:`
  - Search title of page `intitle:`

- Example:  `microsoft edge site:exploit-db.com inurl:exploits intext:remote intitle:Browser`
- Remember to exercise EXTREME caution when using exploit code from non-curated sites

## Fixing Exploits

### Buffer Overflows

#### Return Address

The return address using in a public exploit may not always work.  Options are:

1. Clone the environment and find a reliable return address
2. Look for other valid return addresses on the Internet
3. Use a non-privileged account on the target to copy DLL's with a useable return address using MSFPESCAN

#### Shellcode

It's not always wise to trust the shellcode, so if possible, it's preferable to generate your own shellcode using msfvenom.

#### C Code Caveats

Beware of caveats with C.  One that was discussed is how Strings are built in C.  A string terminates with a null byte `\x00` which counts as one of the characters in the string.  So if you run into an issue with a Buffer Overflow where you are short one byte, check your string construction to make sure you aren't eating up one of your bytes with this terminator.  If so, just increase the size of the string by 1.

#### Matching the Size

When inserting your own shellcode, it's a good idea to match the size of the original shellcode using prepended NOPs.  This is because shorter (or longer) shellcode can shift things around and break the exploit.  To quickly check the length of shellcode, use this Python one-liner:

```python
python -c ‘print(len(shellcode))’
```

Once you know the length of the shellcode, you can manually prepend NOPs or use the `-n X` option with MSFvenom to specify a number of NOP's to prepend  (or NOP equivalents, MSFVenom will use some other characters that do the same thing).  

### Web Exploits

Key questions to ask:

- Does it initiate an HTTP or HTTPS connection?

- Does it access a web app specific path or route?

- Does it leverage a pre-authentication vulnerability?

- If not, how does the exploit authenticate to the web application?

- How are GET or POST requests crafted to trigger and exploit the vulnerability?

- Does it rely on default application settings that may have been changed after installation?

- Will oddities such as self-signed certificates disrupt the exploit?

  - Add this parameter to https requests to ignore the certificate

    ```bash
    verify=False
    ```

#### PHP Shells

Some exploits will upload a PHP shell that is utilized by sending it commands via curl:

```bash
curl -k https://192.168.216.44/uploads/shell.php?cmd=whoami
```

#### Troubleshooting

Index Out of Range error: use print statements to show the string and see what's happening in the background

#### Compiling

Some exploits need to be compiled before they are used, such as exploits that were written for Windows.  You will need to fix any parameters that are personalized or just broken, then compile the code.
