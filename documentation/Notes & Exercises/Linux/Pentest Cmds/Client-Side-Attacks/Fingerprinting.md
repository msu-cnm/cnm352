## Client Fingerprinting

### fingerprint2.js

```bash
cd /var/www/html
sudo wget https://github.com/Valve/fingerprintjs2/archive/master.zip
sudo unzip master.zip
sudo mv fingerprintjs2-master/ fp
```

Browsing to the example index.html (or fingerprint2.html) will extract information from the client machine and display it to the victim.

The User Agent string can be examined here to determine the actual browser version and OS it's running on:  https://developers.whatismybrowser.com/

To transfer the information to the attacker rather than display it to the client, this code can be used:

```javascript
<!doctype html>
<html>
<head>
	<title>Blank Page</title>
</head>
<body>
	<h1>You have been given the finger!</h1>
	//Include the fingerprint2 java library
	<script src="fingerprint2.js"></script>
	<script>
        var d1 = new Date();
        var options = {};
        // Extract the client side information & store in 'components' array
        Fingerprint2.get(options, function (components) {
   			// Get hash of browser fingerprint using the values in components
            var values = components.map(function (component) { return component.value })
            var murmur = Fingerprint2.x64hash128(values.join(''), 31)
            // Generating response with information
            var clientfp = "Client browser fingerprint: " + murmur + "\n\n";
            var d2 = new Date();
            var timeString = "Time to calculate fingerprint: " + (d2 - d1) + "ms\n\n";
            var details = "Detailed information: \n";
            if(typeof window.console !== "undefined") {
                for (var index in components) {
                    var obj = components[index];
                    var value = obj.value;
                        if (value !== null) {
                        var line = obj.key + " = " + value.toString().substr(0, 150);
                        details += line + "\n";
                        }
				}
			}
            // Post results of fingerprint to the server via PHP
            var xmlhttp = new XMLHttpRequest();
            xmlhttp.open("POST", "/fp/js.php");
            xmlhttp.setRequestHeader("Content-Type", "application/txt");
            xmlhttp.send(clientfp + timeString + details);
			});
	</script>
</body>
</html>	
```

This PHP code will receive the information from the client:

```php+HTML
<?php
# /var/www/html/fb/js.php
# Get client IP from server request
$data = "Client IP Address: " . $_SERVER['REMOTE_ADDR'] . "\n";
$data .= file_get_contents('php://input');
$data .= "---------------------------------\n\n";
# Append results to file
file_put_contents('/var/www/html/fp/fingerprint.txt', print_r($data, true), FILE_APPEND | LOCK_EX);
?>
```

For this code to work, you must be running Apache (with PHP) and Apache's www-data user must be able to write to the `fp` directory:

```bash
sudo chown www-data: /var/www/html/fp
```

When the client visits the fingerprint page, they will be presented with a message and the details of their client will be stored in `/var/www/html/fp/fingerprint.txt`