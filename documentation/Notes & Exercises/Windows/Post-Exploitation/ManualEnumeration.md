## Windows Enumeration Commands

Note:  Some tips are found in the Linux Enumeration Commands document but are not repeated here.

### Areas of Enumeration

#### Users

```powershell
# Show current user
whoami
# Show other accounts on the Windows System
net user
# Pass get more specific info on a user, like groups
net user USERNAME
# Check rights of current user
whoami /priv
```

#### Hostname

```powershell
# Show hostname
hostname
```

#### System OS & Architecture

```powershell
systeminfo | findstr /B /C:"OS Name" /C:"OS Version" /C:"System Type"

# Options
/B	# Match patterns at beginning of a line
/C:	# Specifies search string
```

#### Running Processes & Services

```powershell
# Show running processes
tasklist /SVC
# Options
/SVC 	# returns processes that are part of a windows service
```

Powershell Version:

```powershell
Get-WmiObject win32_service | Select-Object Name, State, PathName | Where-Object {$_.State -like 'Running'}

# Options
Get-WmiObject win32_service 	# Gets the list of services
Select-Object Name, State, PathName		# Selects columns to show
Where-Object {$_.State -like 'Running'}	# Filters by running processes

# Extra Options
Where-Object {$_.Name -like 'Serviio'}	# Match by friendly name
Where-Object {$_.Name -Match "^Ser.*"} # Match by name using a regular expression
Where-Object {$_.ProcessName -like 'Serviio'} # Match by process name
```

Check the output for services with known vulnerabilities.  Note:  This does not output processes run by privileged users.

To show the file path of binaries associated with services:

```powershell
# From command prompt (not Powershell)
wmic service get displayname,pathname
```

To show only services set to automatically start:

```powershell
wmic service get name,displayname,pathname,startmode | findstr /i "auto"

# Further refine results with additional filtering

wmic service get name,displayname,pathname,startmode | findstr /i "auto" | findstr /i /v "c:\windows"
```

#### Network Information

```powershell
# Show Interface Info
ipconfig /all

# Show Route tables
route print

# Show active & listening connections
netstat -ano
# Options 
a # all active TCP connections
n # displays address numerically
o # displays owner process ID of each connection
```

#### Firewall Status and Rules

```powershell
# Show current FW profile
netsh advfirewall show currentprofile

# Show all firewall rules
netsh advfirewall firewall show rule name=all
```

#### Scheduled Tasks

```powershell
schtasks /query /fo LIST /v

# Options
/query	# Displays tasks
/fo		# List output as list
/v		# Verbose output
/TN		# Specify task name - leave off to show all
```

#### Installed Applications and Patch Levels

```powershell
# Get a list of all installed applications (only those installed by Windows Installer)
wmic product get name, version, vendor

# Get system wide updates
wmic qfe get Caption, Description, HotFixID, InstalledOn

#qfe = Win32 Quick Fix Engineering
```

#### Readable/Writable Files and Directories

Can scan with accesschk.exe from SysInternals (see related doc)

With Powershell:

```powershell
# Enter powershell
powershell

# Search cmd
Get-ChildItem "C:\Program Files" -Recurse | Get-ACL | ?{$_.AccessToString -match "Everyone\sAllow\s\sModify"}

# Options
Get-ACL	# Retrieve all permissions for a file or directory, this cannot be run recursively, so it is fed the output of Get-ChildItem
$_.AccessToString	# Shows access properties of the files
```

#### Unmounted Disks

```powershell
# Shows all currently mounted drive letters
wmic logicaldisk get caption

# At the end of the help output, Shows all currently mounted drives as well as those physically connected but not currently mounted.
mountvol
```

#### Device Drivers and Kernel Modules

To get a general list (no versions) of all drivers

````powershell
# Enter powershell session to filter output of command
powershell
# Enumerate drivers & kernel modules
driverquery.exe /v /fo csv | ConvertFrom-CSV | Select-Object 'Display Name', 'Start Mode', Path

# Options
/v	# Verbose output
/fo csv	# Output to CSV
ConvertFrom-CSV	# Export from CSV file
Select-Object	# Pick specific object properties to display
````

To get Driver Versions of specific drivers (ex. VMware):

```powershell
Get-WmiObject Win32_PnPSignedDriver | Select-Object DeviceName, DriverVersion, Manufacturer | Where-Object {$_.DeviceName -like "*VMware*"}
```

#### Binaries that AutoElevate

##### AlwaysInstallElevated

If this key is enabled, any Windows user can run Windows Installer packages with elevated privileges...Nice day for an installer with a payload injected ðŸ˜… If either of these is enabled (0x1), an MSI file can be crafted with a payload.

```powershell
# Enabled per user
reg query HKEY_CURRENT_USER\Software\Policies\Microsoft\Windows\Installer

# Enabled per machine
reg query HKEY_LOCAL_MACHINE\Software\Policies\Microsoft\Windows\Installer
```

### User Files

#### Enumerate user folders

```bash
cd c:\users\
```

#### Enumerate any mailboxes

```powershell
dir /s *.dbx
```

Use undbx to extract emails from dbx files

```bash
sudo apt install undbx
# Output the messages in separate files inside a folder with the name of the file
undbx FILE.dbx

# Nice little script
for i in $(ls *.dbx); do undbx $i; done;
```

### SAM Files

For Windows 

### General Enumeration Tools

WMIC - https://docs.microsoft.com/en-us/windows/win32/wmisdk/wmic